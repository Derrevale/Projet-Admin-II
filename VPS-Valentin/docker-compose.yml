version: '2'

services: 

    resolver:
        build: 
            context: ./Resolver
            dockerfile: Dockerfile
        dns: 172.16.1.3
        ports: 
            - "53:53/tcp"
            - "53:53/udp"
        networks: 
            local_net:
                ipv4_address: 172.16.1.4
        volumes:
            - ./Resolver/named.conf:/etc/bind/named.conf
        container_name: resolver

    intranet:
        build:
            context: ./Intranet_ERP
            dockerfile: Dockerfile
        dns: 172.16.1.3
        ports:
            - "8080:80"
        networks:
            local_net:
                ipv4_address: 172.16.1.2
        container_name: intranet_ERP



    soa_interne:
        build: 
            context: ./SOA_int 
            dockerfile: Dockerfile
        dns: 172.16.1.3
        
        networks: 
            local_net:
                ipv4_address: 172.16.1.3
        volumes:
            - ./SOA_int/named.conf:/etc/bind/named.conf
            - ./SOA_int/zones/intranet.l2-5.ephec-ti.be:/etc/bind/intranet.l2-5.ephec-ti.be
            - ./SOA_int/zones/0.16.172.in-addr.arpa:/etc/bind/0.16.172.in-addr.arpa
        container_name: soa_interne


    administration:
        build: 
            context: ./Intranet_ERP/Docker-administration
            dockerfile: Dockerfile
        dns: 172.16.1.3
        networks:
            administration_net:
                ipv4_address: 172.16.4.2
        container_name: user_admin1

    commerciaux:
        build: 
            context: ./Intranet_ERP/Docker-commerciaux
            dockerfile: Dockerfile
        dns: 172.16.1.3
        networks:
            commerciaux_net:
                ipv4_address: 172.16.3.2
        container_name: user_commerciaux1

    direction:
        build: 
            context: ./Intranet_ERP/Docker-direction
            dockerfile: Dockerfile
        dns: 172.16.1.3
        networks:
            direction_net:
                ipv4_address: 172.16.2.2
        container_name: user_direction1

    atelier:
        build: 
            context: ./Intranet_ERP/Docker-atelier
            dockerfile: Dockerfile
        dns: 172.16.1.3
        networks:
            atelier_net:
                ipv4_address: 172.16.5.2
        container_name: user_atelier1

##############################################
##       Docker Networks Configuration      ##
##############################################

networks:

    local_net:
        ipam:
            driver: default
            config:
                - subnet: 172.16.1.0/24
                  gateway:  172.16.1.1

    direction_net:
        ipam:
            driver: default
            config:
                - subnet: 172.16.2.0/24
                  gateway:  172.16.2.1

    commerciaux_net:
        ipam:
            driver: default
            config:
                - subnet: 172.16.3.0/24
                  gateway:  172.16.3.1

    administration_net:
        ipam:
            driver: default
            config:
                - subnet: 172.16.4.0/24
                  gateway: 172.16.4.1

    atelier_net:
        ipam:
            driver: default
            config:
                - subnet: 172.16.5.0/24
                  gateway: 172.16.5.1

    dmz_net:
        ipam:
            driver: default
            config:
                - subnet: 172.16.0.0/24
                  gateway: 172.16.0.1
